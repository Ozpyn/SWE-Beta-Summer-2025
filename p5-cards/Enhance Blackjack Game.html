<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Enhanced Blackjack</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: Arial, sans-serif;
      background-color: #003300;
    }

    #game-container {
      width: 100vw;
      height: 100vh;
      background: radial-gradient(circle at center, #006400, #003300);
      position: relative;
    }

    .hand {
      position: absolute;
      display: flex;
      gap: 0.5vw;
    }

    #player-hand {
      bottom: 10%;
      left: 35%;
    }

    #split-hand {
      bottom: 10%;
      left: 60%;
    }

    #dealer-hand {
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
    }

    .card svg {
      width: 10vw;
      height: 15vw;
      max-width: 100px;
      max-height: 150px;
    }

    #controls {
      position: absolute;
      bottom: 2%;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 1em;
    }

    button {
      padding: 0.5em 1em;
      font-size: 1em;
      cursor: pointer;
      border-radius: 6px;
      border: none;
    }

    #popup {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      font-size: 2em;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      flex-direction: column;
    }

    footer {
      position: absolute;
      bottom: 0;
      width: 100%;
      font-size: 0.8em;
      text-align: center;
      color: white;
      background: rgba(0, 0, 0, 0.3);
      padding: 0.3em 0;
    }

    footer a {
      color: #ffffff;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div class="hand" id="dealer-hand"></div>
    <div class="hand" id="player-hand"></div>
    <div class="hand" id="split-hand" style="display: none;"></div>

    <div id="controls">
      <button onclick="hit()">Hit</button>
      <button onclick="stay()">Stay</button>
      <button onclick="split()" id="splitBtn">Split</button>
      <button onclick="startGame()">Restart</button>
    </div>

    <div id="popup" onclick="hidePopup()"></div>

    <footer>
      Thanks to 
      <a href="https://iamvector.com/all-icons/card-game-rules" target="_blank">I Am Vector</a>, 
      <a href="https://www.freepik.com/vectors/playing-card-suits-free-svg" target="_blank">FreePik</a>, and 
      <a href="https://icons8.com/icons/set/deck" target="_blank">ICONS8</a>
    </footer>
  </div>

  <script>
    const suits = ['♠', '♥', '♦', '♣'];
    const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

    let deck = [];
    let playerHand = [];
    let splitHand = [];
    let dealerHand = [];
    let activeHand = 'main';
    let gameOver = false;
    let hasSplit = false;

    function createDeck() {
      const d = [];
      for (let suit of suits) {
        for (let rank of ranks) {
          d.push({ suit, rank });
        }
      }
      return d.sort(() => Math.random() - 0.5);
    }

    function cardValue(card) {
      if (['J', 'Q', 'K'].includes(card.rank)) return 10;
      if (card.rank === 'A') return 11;
      return parseInt(card.rank);
    }

    function handValue(hand) {
      let value = 0;
      let aces = 0;
      hand.forEach(card => {
        value += cardValue(card);
        if (card.rank === 'A') aces++;
      });
      while (value > 21 && aces > 0) {
        value -= 10;
        aces--;
      }
      return value;
    }

    function createCardElement(card) {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <svg viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg">
          <rect x="0" y="0" width="100" height="150" rx="10" ry="10" fill="white" stroke="black"/>
          <text x="10" y="25" font-size="18" fill="black">${card.rank}</text>
          <text x="80" y="140" font-size="18" fill="black">${card.suit}</text>
        </svg>
      `;
      return div;
    }

    function renderHands() {
      document.getElementById('player-hand').innerHTML = '';
      document.getElementById('dealer-hand').innerHTML = '';
      document.getElementById('split-hand').innerHTML = '';

      playerHand.forEach(c => document.getElementById('player-hand').appendChild(createCardElement(c)));
      dealerHand.forEach(c => document.getElementById('dealer-hand').appendChild(createCardElement(c)));

      if (hasSplit) {
        document.getElementById('split-hand').style.display = 'flex';
        splitHand.forEach(c => document.getElementById('split-hand').appendChild(createCardElement(c)));
      }
    }

    function hit() {
      if (gameOver) return;
      let hand = activeHand === 'split' ? splitHand : playerHand;
      hand.push(deck.pop());
      renderHands();

      if (handValue(hand) > 21) {
        if (hasSplit && activeHand === 'main') {
          activeHand = 'split';
        } else {
          dealerTurn();
        }
      }
    }

    function stay() {
      if (hasSplit && activeHand === 'main') {
        activeHand = 'split';
      } else {
        dealerTurn();
      }
    }

    function split() {
      if (playerHand.length === 2 && playerHand[0].rank === playerHand[1].rank && !hasSplit) {
        splitHand.push(playerHand.pop());
        playerHand.push(deck.pop());
        splitHand.push(deck.pop());
        hasSplit = true;
        document.getElementById('split-hand').style.display = 'flex';
        renderHands();
      }
    }

    function dealerTurn() {
      gameOver = true;
      while (handValue(dealerHand) < 17) {
        dealerHand.push(deck.pop());
      }
      renderHands();
      evaluateResults();
    }

    function evaluateResults() {
      const results = [];

      const evaluate = (hand, label) => {
        const pv = handValue(hand);
        const dv = handValue(dealerHand);
        if (pv > 21) return `${label}: Bust`;
        if (dv > 21) return `${label}: Win`;
        if (pv > dv) return `${label}: Win`;
        if (pv < dv) return `${label}: Lose`;
        return `${label}: Push`;
      };

      results.push(evaluate(playerHand, "Hand 1"));

      if (hasSplit) {
        results.push(evaluate(splitHand, "Hand 2"));
      }

      showPopup(results.join(" | "));
    }

    function showPopup(msg) {
      const popup = document.getElementById("popup");
      popup.innerText = msg + " (click to close)";
      popup.style.display = "flex";
    }

    function hidePopup() {
      document.getElementById("popup").style.display = "none";
    }

    function startGame() {
      deck = createDeck();
      playerHand = [deck.pop(), deck.pop()];
      dealerHand = [deck.pop(), deck.pop()];
      splitHand = [];
      hasSplit = false;
      activeHand = 'main';
      gameOver = false;
      document.getElementById('split-hand').style.display = 'none';
      hidePopup();
      renderHands();

      document.getElementById('splitBtn').disabled = !(playerHand[0].rank === playerHand[1].rank);
    }

    startGame();
  </script>
</body>
</html>
